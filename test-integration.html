<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Tally Integration - Kejar Sains</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #f0f4f8 0%, #e8eef4 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            color: #1a2a3a;
            margin-bottom: 16px;
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h2 {
            color: #2c3e50;
            margin-bottom: 16px;
            font-size: 1.25rem;
        }
        
        .test-result {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .test-result.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .test-description {
            color: #5a6a7a;
            margin-bottom: 12px;
            line-height: 1.6;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f0f4f8;
            color: #5a6a7a;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .console-output {
            background: #1a2a3a;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Tally Integration</h1>
        <p class="test-description">
            Halaman ini untuk testing integrasi Tally dengan worksheet Kejar Sains.
            Isi data di bawah ini untuk test submit ke Tally forms.
        </p>
        
        <!-- Test Results Section -->
        <div class="test-section">
            <h2>üìä Test Results</h2>
            
            <div id="test-results">
                <div class="test-result pending" id="test-1">
                    <strong>Test 1: Load Scripts</strong>
                    <p>Menunggu test...</p>
                </div>
                
                <div class="test-result pending" id="test-2">
                    <strong>Test 2: TallyConfig</strong>
                    <p>Menunggu test...</p>
                </div>
                
                <div class="test-result pending" id="test-3">
                    <strong>Test 3: TallyIntegration</strong>
                    <p>Menunggu test...</p>
                </div>
                
                <div class="test-result pending" id="test-4">
                    <strong>Test 4: Data Collection</strong>
                    <p>Menunggu test...</p>
                </div>
                
                <div class="test-result pending" id="test-5">
                    <strong>Test 5: Form URLs</strong>
                    <p>Menunggu test...</p>
                </div>
            </div>
        </div>
        
        <!-- Sample Data Section -->
        <div class="test-section">
            <h2>üìù Sample Data (untuk test)</h2>
            
            <form id="test-form">
                <div class="form-group">
                    <label for="test-name">Nama Lengkap</label>
                    <input type="text" id="test-name" placeholder="Contoh: Ahmad Surya">
                </div>
                
                <div class="form-group">
                    <label for="test-class">Kelas</label>
                    <select id="test-class">
                        <option value="">Pilih Kelas</option>
                        <option value="7-A">7-A</option>
                        <option value="7-B">7-B</option>
                        <option value="7-C">7-C</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="test-answer">Jawaban Contoh</label>
                    <textarea id="test-answer" placeholder="Ini adalah jawaban contoh untuk testing..."></textarea>
                </div>
            </form>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="runTests()">üîÑ Run All Tests</button>
                <button class="btn btn-secondary" onclick="clearConsole()">üóëÔ∏è Clear Console</button>
            </div>
        </div>
        
        <!-- Console Output Section -->
        <div class="test-section">
            <h2>üíª Console Output</h2>
            <div class="console-output" id="console-output">
Console output akan muncul di sini...
            </div>
        </div>
        
        <!-- Quick Actions Section -->
        <div class="test-section">
            <h2>üöÄ Quick Actions</h2>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="testDufan()">Test Dufan Form</button>
                <button class="btn btn-primary" onclick="testMuseum()">Test Museum BI Form</button>
                <button class="btn btn-secondary" onclick="showFieldIds()">Show Field IDs</button>
            </div>
        </div>
    </div>
    
    <!-- Load Tally Integration -->
    <script src="js/tally-config.js"></script>
    <script src="js/tally-integration.js"></script>
    
    <script>
        // Console output helper
        const consoleOutput = document.getElementById('console-output');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            consoleOutput.textContent += '\n' + logMessage;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            console.log(message);
        }
        
        function clearConsole() {
            consoleOutput.textContent = 'Console cleared. Ready for new tests...';
        }
        
        function updateTest(testId, success, message) {
            const testElement = document.getElementById(testId);
            testElement.className = `test-result ${success ? 'success' : 'error'}`;
            testElement.querySelector('p').textContent = message;
        }
        
        // Test functions
        function runTests() {
            log('üöÄ Starting test suite...');
            
            // Test 1: Load Scripts
            try {
                const tallyConfigLoaded = typeof window.TallyConfig !== 'undefined';
                const tallyIntegrationLoaded = typeof window.TallyIntegration !== 'undefined';
                
                if (tallyConfigLoaded && tallyIntegrationLoaded) {
                    updateTest('test-1', true, '‚úÖ Scripts loaded successfully');
                    log('‚úÖ Test 1 PASSED: Scripts loaded');
                } else {
                    updateTest('test-1', false, '‚ùå Scripts not loaded');
                    log('‚ùå Test 1 FAILED: Scripts not loaded');
                }
            } catch (error) {
                updateTest('test-1', false, `‚ùå Error: ${error.message}`);
                log(`‚ùå Test 1 FAILED: ${error.message}`);
            }
            
            // Test 2: TallyConfig
            try {
                if (window.TallyConfig && window.TallyConfig.forms) {
                    const hasDufan = window.TallyConfig.forms.dufan;
                    const hasMuseumBI = window.TallyConfig.forms.museumBI;
                    
                    if (hasDufan && hasMuseumBI) {
                        updateTest('test-2', true, '‚úÖ TallyConfig valid dengan kedua form');
                        log(`‚úÖ Test 2 PASSED: Dufan ID = ${hasDufan.id}, Museum BI ID = ${hasMuseumBI.id}`);
                    } else {
                        updateTest('test-2', false, '‚ùå Form configuration incomplete');
                        log('‚ùå Test 2 FAILED: Form configuration incomplete');
                    }
                } else {
                    updateTest('test-2', false, '‚ùå TallyConfig invalid');
                    log('‚ùå Test 2 FAILED: TallyConfig invalid');
                }
            } catch (error) {
                updateTest('test-2', false, `‚ùå Error: ${error.message}`);
                log(`‚ùå Test 2 FAILED: ${error.message}`);
            }
            
            // Test 3: TallyIntegration
            try {
                if (window.TallyIntegration) {
                    const hasInit = typeof window.TallyIntegration.init === 'function';
                    const hasStart = typeof window.TallyIntegration.startSubmission === 'function';
                    
                    if (hasInit && hasStart) {
                        updateTest('test-3', true, '‚úÖ TallyIntegration methods available');
                        log('‚úÖ Test 3 PASSED: TallyIntegration methods available');
                    } else {
                        updateTest('test-3', false, '‚ùå Missing required methods');
                        log('‚ùå Test 3 FAILED: Missing required methods');
                    }
                } else {
                    updateTest('test-3', false, '‚ùå TallyIntegration not found');
                    log('‚ùå Test 3 FAILED: TallyIntegration not found');
                }
            } catch (error) {
                updateTest('test-3', false, `‚ùå Error: ${error.message}`);
                log(`‚ùå Test 3 FAILED: ${error.message}`);
            }
            
            // Test 4: Data Collection
            try {
                if (window.TallyIntegration) {
                    // Test data collection functionality
                    const testData = {
                        worksheetType: 'dufan',
                        studentInfo: { name: 'Test Student', class: '7-A' },
                        sections: {
                            fisika: [
                                { number: 1, answer: 'Test answer 1', isEmpty: false },
                                { number: 2, answer: 'Test answer 2', isEmpty: false }
                            ]
                        }
                    };
                    
                    // Validate test data
                    const isValid = testData.studentInfo?.name && testData.studentInfo?.class;
                    
                    if (isValid) {
                        updateTest('test-4', true, '‚úÖ Data collection structure valid');
                        log('‚úÖ Test 4 PASSED: Data collection structure valid');
                    } else {
                        updateTest('test-4', false, '‚ùå Invalid data structure');
                        log('‚ùå Test 4 FAILED: Invalid data structure');
                    }
                } else {
                    updateTest('test-4', false, '‚ùå TallyIntegration not available');
                    log('‚ùå Test 4 FAILED: TallyIntegration not available');
                }
            } catch (error) {
                updateTest('test-4', false, `‚ùå Error: ${error.message}`);
                log(`‚ùå Test 4 FAILED: ${error.message}`);
            }
            
            // Test 5: Form URLs
            try {
                const dufanUrl = window.TallyConfig?.forms?.dufan?.url;
                const museumUrl = window.TallyConfig?.forms?.museumBI?.url;
                
                const dufanValid = dufanUrl && dufanUrl.includes('tally.so');
                const museumValid = museumUrl && museumUrl.includes('tally.so');
                
                if (dufanValid && museumValid) {
                    updateTest('test-5', true, '‚úÖ Form URLs valid');
                    log(`‚úÖ Test 5 PASSED: Dufan URL = ${dufanUrl}, Museum URL = ${museumUrl}`);
                } else {
                    updateTest('test-5', false, '‚ùå Invalid form URLs');
                    log(`‚ùå Test 5 FAILED: Dufan URL = ${dufanUrl}, Museum URL = ${museumUrl}`);
                }
            } catch (error) {
                updateTest('test-5', false, `‚ùå Error: ${error.message}`);
                log(`‚ùå Test 5 FAILED: ${error.message}`);
            }
            
            log('üèÅ Test suite completed');
        }
        
        // Quick action functions
        function testDufan() {
            log('üöÄ Testing Dufan form submission...');
            
            if (window.TallyIntegration) {
                // Collect sample data
                const sampleData = {
                    studentInfo: {
                        name: document.getElementById('test-name').value || 'Test Student',
                        class: document.getElementById('test-class').value || '7-A'
                    },
                    sections: {}
                };
                
                // Log data that would be submitted
                log(`üì§ Data to submit:`);
                log(`   - Name: ${sampleData.studentInfo.name}`);
                log(`   - Class: ${sampleData.studentInfo.class}`);
                log(`   - Worksheet: dufan`);
                
                // Try to start submission (will open modal)
                try {
                    TallyIntegration.startSubmission('dufan');
                    log('‚úÖ Dufan form submission initiated');
                } catch (error) {
                    log(`‚ùå Error: ${error.message}`);
                }
            } else {
                log('‚ùå TallyIntegration not available');
            }
        }
        
        function testMuseum() {
            log('üöÄ Testing Museum BI form submission...');
            
            if (window.TallyIntegration) {
                const sampleData = {
                    studentInfo: {
                        name: document.getElementById('test-name').value || 'Test Student',
                        class: document.getElementById('test-class').value || '7-A'
                    },
                    sections: {}
                };
                
                log(`üì§ Data to submit:`);
                log(`   - Name: ${sampleData.studentInfo.name}`);
                log(`   - Class: ${sampleData.studentInfo.class}`);
                log(`   - Worksheet: museumBI`);
                
                try {
                    TallyIntegration.startSubmission('museumBI');
                    log('‚úÖ Museum BI form submission initiated');
                } catch (error) {
                    log(`‚ùå Error: ${error.message}`);
                }
            } else {
                log('‚ùå TallyIntegration not available');
            }
        }
        
        function showFieldIds() {
            log('üìã Field ID Information:');
            
            if (window.TallyConfig) {
                log(`Dufan Form ID: ${window.TallyConfig.forms.dufan.id}`);
                log(`Dufan Form URL: ${window.TallyConfig.forms.dufan.url}`);
                log(`Museum BI Form ID: ${window.TallyConfig.forms.museumBI.id}`);
                log(`Museum BI Form URL: ${window.TallyConfig.forms.museumBI.url}`);
                log('');
                log('Note: Field IDs will be auto-detected from Tally form.');
                log('To get field IDs: Open form in browser dev tools -> inspect input fields.');
            } else {
                log('‚ùå TallyConfig not available');
            }
        }
        
        // Auto-run tests on load
        document.addEventListener('DOMContentLoaded', function() {
            log('üß™ Test page loaded. Running initial tests...');
            
            setTimeout(function() {
                runTests();
            }, 500);
        });
    </script>
</body>
</html>
